<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Ocean Scene</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: radial-gradient(circle at center, #0f2027, #203a43, #2c5364); 
            overflow: hidden; 
        }
        #container { width: 100vw; height: 100vh; }
        #loading {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 18px;
        }
        .loader {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #fff;
            border-radius: 50%;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
    </style>
</head>
<body>
<div id="container">
    <div id="loading">
        <div class="loader"></div>
        Loading Ocean Scene...
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<script>
let scene, camera, renderer, controls, mixer, model;

init();
animate();

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x081828);

    camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 0.1, 200);
    camera.position.set(0, 3, 8);

    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.outputEncoding = THREE.sRGBEncoding;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.6;
    renderer.physicallyCorrectLights = true;

    document.getElementById('container').appendChild(renderer.domElement);

    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 0.4;

    setupLighting();
    loadModel();

    window.addEventListener('resize', onWindowResize);
}

function setupLighting() {
    // Hafif ortam ışığı
    scene.add(new THREE.AmbientLight(0x99ccff, 0.4));

    // Alttan yukarı yumuşak SpotLight'lar (yakamoz etkisi)
    const spots = [
        { color: 0x77bbff, pos: [0, -2, 0], intensity: 3 },
        { color: 0x99ddff, pos: [2, -1, 2], intensity: 2.5 },
        { color: 0xaaccff, pos: [-2, -1, -2], intensity: 2.2 },
        { color: 0xffffff, pos: [0, -1.5, 3], intensity: 1.8 },
    ];
    spots.forEach(s => {
        const light = new THREE.SpotLight(s.color, s.intensity, 20, Math.PI/2.5, 0.4, 2);
        light.position.set(...s.pos);
        light.target.position.set(0, 0, 0);
        scene.add(light.target);
        light.castShadow = true;
        scene.add(light);
    });

    // Yukarıdan gelen hafif güneş ışığı
    const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
    dirLight.position.set(5, 10, 5);
    dirLight.castShadow = true;
    scene.add(dirLight);

    // Parlayan mavi-beyaz noktalar (yansıma parıltısı)
    const shimmer = [
        [3, 2, 3], [-3, 2, -3], [0, 3, 0]
    ];
    shimmer.forEach(p => {
        const l = new THREE.PointLight(0xaaccff, 1.2, 15);
        l.position.set(...p);
        scene.add(l);
    });

    // Hafif sis, derinlik duygusu
    scene.fog = new THREE.FogExp2(0x0a1828, 0.02);
}

function loadModel() {
    const loader = new THREE.GLTFLoader();
    loader.load('./dalgazem.glb', (gltf) => {
        document.getElementById('loading').style.display = 'none';
        model = gltf.scene;
        scene.add(model);

        model.traverse((child) => {
            if (child.isMesh) {
                child.castShadow = true;
                child.receiveShadow = true;

                if (child.material) {
                    // Su görünümü için materyal özellikleri
                    child.material.transparent = true;
                    child.material.opacity = 0.75;
                    child.material.metalness = 1.0;
                    child.material.roughness = 0.05;
                    child.material.envMapIntensity = 1.5;
                    if ('transmission' in child.material) child.material.transmission = 0.9;
                    if ('ior' in child.material) child.material.ior = 1.33;
                }
            }
        });

        // Animasyon varsa
        if (gltf.animations.length > 0) {
            mixer = new THREE.AnimationMixer(model);
            gltf.animations.forEach(a => mixer.clipAction(a).play());
        }

    }, undefined, (err) => console.error(err));
}

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
    requestAnimationFrame(animate);
    if (mixer) mixer.update(0.016);
    controls.update();
    renderer.render(scene, camera);
}
</script>
</body>
</html>
